package {
    default_applicable_licenses: ["Android-Apache-2.0"],
}

android_app {
    name: "AconfigDemoActivity",
    manifest: "AndroidManifest.xml",
    srcs: [
        "src/**/*.java"
    ],
    platform_apis: true,
    certificate: "platform",
    static_libs: [
        "ContentLibs",
        "dagger2",
        "jsr330",
    ],
    jni_libs: [
        "libexample_cpp_lib",
    ],
    optimize: {
        enabled: true,
        proguard_compatibility: false,
        shrink: true,
        optimize: false,
        obfuscate: false,
        shrink_resources: true,
    },
    required: ["libexample_rust_jni"],
    plugins: ["dagger2-compiler"]
}

aconfig_declarations {
    name: "aconfig_demo_flags",
    package: "com.example.android.aconfig.demo.flags",
    srcs: ["aconfig_demo_flags.aconfig"],
}


java_aconfig_library {
    name: "aconfig_demo_flags_java_lib",
    aconfig_declarations: "aconfig_demo_flags",
}

filegroup {
    name: "ContentLibsFile",
    srcs: [
        "lib/**/*.java",
    ],
}

java_library {
    name: "ContentLibs",
    srcs: [
        ":ContentLibsFile",
    ],
    sdk_version: "current",
    static_libs: [
        "aconfig_demo_flags_java_lib",
    ],
    libs: ["jsr330"],
}

cc_aconfig_library {
    name: "aconfig_demo_flags_c_lib",
    aconfig_declarations: "aconfig_demo_flags",
}

cc_library {
    name: "libexample_cpp_lib",
    srcs: ["src/example_cpp_lib.cc"],
    double_loadable: true,
    cflags: [
        "-Wall",
        "-Werror",
        "-Wno-unused-function",
        "-Wno-unused-parameter",
    ],
    header_libs: [
      "jni_headers",
    ],
    shared_libs: [
        "server_configurable_flags",
    ],
    static_libs: [
        "aconfig_demo_flags_c_lib",
    ],
    export_include_dirs: ["src/include"],
}

rust_aconfig_library {
    name: "libaconfig_demo_flags_rust",
    crate_name: "aconfig_demo_flags_rust",
    aconfig_declarations: "aconfig_demo_flags",
}

rust_ffi_shared {
    name: "libexample_rust_jni",
    crate_name: "example_rust_jni",
    srcs: ["src/lib.rs"],
    rustlibs: [
        "libjni",
        "libaconfig_demo_flags_rust",
    ]
}
